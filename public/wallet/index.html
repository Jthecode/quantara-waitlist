<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Quantara Wallet — Preview</title>
  <meta name="description" content="Preview of the Quantara Wallet for Devnet-0. Join the waitlist for early access.">
  <meta name="color-scheme" content="dark">
  <meta name="theme-color" content="#000000">
  <link rel="icon" href="data:,">
  <script src="https://cdn.tailwindcss.com" defer></script>

  <style>
    :root { --q-accent: 234,179,8; /* yellow-500 */ }

    /* Cosmic background (CSP-safe) */
    body {
      background:
        radial-gradient(1200px 600px at 18% -10%, rgba(255,255,255,.06), transparent 60%),
        radial-gradient(900px 500px at 85% 0%, rgba(234,179,8,.08), transparent 60%),
        #000;
      position: relative;
      overflow-x: hidden;
      color: #fff;
    }
    .bg-grid::before {
      content: ""; position: fixed; inset: 0; pointer-events: none; opacity: .15;
      background-image:
        linear-gradient(to right, rgba(255,255,255,.08) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.08) 1px, transparent 1px);
      background-size: 42px 42px;
      mask-image: linear-gradient(to bottom, transparent, black 18%, black 82%, transparent);
    }
    .nebula::after {
      content:""; position:absolute; inset:-25% -10% auto auto; width:60vw; height:60vh;
      background: radial-gradient(closest-side, rgba(234,179,8,.16), rgba(234,179,8,0));
      filter: blur(40px); opacity:.55; transform: translateZ(0);
    }

    /* Cards / glass */
    .card {
      background: linear-gradient(180deg, rgba(24,24,27,.65), rgba(9,9,11,.65));
      border: 1px solid rgba(63,63,70,.7);
      box-shadow: 0 0 0 1px rgba(255,255,255,.02) inset, 0 10px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
    }
    .card:hover { border-color: rgba(161,161,170,.6); }

    /* Accent token */
    .token-ring {
      position: relative; width: 52px; height: 52px; border-radius: 9999px;
      background: radial-gradient(circle at 35% 30%, rgba(255,255,255,.25), rgba(255,255,255,0) 55%);
      border: 1px solid rgba(234,179,8,.35);
      box-shadow: 0 0 24px rgba(234,179,8,.25), inset 0 0 16px rgba(234,179,8,.15);
    }
    .token-ring::after {
      content: ""; position: absolute; inset: 9px; border-radius: inherit;
      background: radial-gradient(circle at 65% 70%, rgba(234,179,8,.35), rgba(234,179,8,.05) 55%, transparent 70%);
      filter: blur(0.2px);
    }

    /* Beam badge */
    .beam {
      position: relative;
      border: 1px solid #3f3f46;
      background: linear-gradient(90deg, rgba(161,161,170,.12), rgba(82,82,91,.1));
      padding-left: 20px;
    }
    .beam::before {
      content:""; position:absolute; left:8px; top:50%; width:8px; height:8px; border-radius:9999px;
      transform: translateY(-50%); background:#a1a1aa; box-shadow: 0 0 8px #a1a1aa;
    }
    .beam.live {
      border-color:#065f46;
      background: linear-gradient(90deg, rgba(16,185,129,.14), rgba(5,150,105,.1));
    }
    .beam.live::before { background:#10b981; box-shadow:0 0 12px #10b981; }

    /* Skeleton shimmer */
    .skeleton{position:relative;overflow:hidden;background:rgba(255,255,255,.06)}
    .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);
      animation:shimmer 1.2s linear infinite}
    @keyframes shimmer{100%{transform:translateX(100%)}}
    @media (prefers-reduced-motion: reduce){.skeleton::after{animation:none}}

    pre, code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace }
    :focus-visible { outline: 2px solid rgba(var(--q-accent),.7); outline-offset: 2px; border-radius: 8px; }
  </style>
</head>
<body class="min-h-screen bg-grid">
  <div class="nebula"></div>

  <main class="relative max-w-4xl mx-auto px-6 py-16">
    <a href="/" class="text-sm opacity-70 hover:opacity-100 transition" aria-label="Back to Waitlist">&larr; Back to Waitlist</a>

    <header class="mt-6">
      <div class="flex items-center gap-4">
        <div class="token-ring" aria-hidden="true"></div>
        <div>
          <div class="flex items-center gap-3">
            <h1 class="text-4xl font-semibold tracking-tight">Quantara Wallet</h1>
            <span id="badge" class="beam text-xs rounded-md pr-2 py-1">Preview</span>
          </div>
          <p class="mt-2 text-zinc-300">
            Non-custodial sr25519 • AES-GCM + Argon2id • SS58=<span id="ss58" class="tabular-nums">73</span> •
            <span id="decimals" class="tabular-nums">12</span> decimals
          </p>
        </div>
      </div>
    </header>

    <!-- Info / countdown -->
    <section class="mt-6 grid md:grid-cols-2 gap-4" aria-label="Release and RPC">
      <div class="rounded-xl p-5 card">
        <div class="flex items-center gap-2 text-xs uppercase tracking-wide text-zinc-400">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" class="opacity-80"><path d="M8 7h8M7 12h10M6 17h12M4 5h16v14H4z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>
          Release
        </div>
        <time id="releaseAt" class="mt-1 block text-lg font-medium">TBD</time>
        <p id="countdown" class="mt-1 text-sm text-zinc-400">—</p>
      </div>
      <div class="rounded-xl p-5 card">
        <div class="flex items-center justify-between gap-2">
          <div>
            <div class="flex items-center gap-2 text-xs uppercase tracking-wide text-zinc-400">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" class="opacity-80"><path d="M8 7v6m8-6v6M5 13h14M12 19v-6" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>
              RPC (WS)
            </div>
            <div id="rpc" class="mt-1 truncate text-lg font-medium" title="WebSocket RPC endpoint">RPC: not configured</div>
            <p class="mt-1 text-xs text-zinc-500">Configured from <code>/api/config</code></p>
          </div>
          <span id="rpcChip" class="text-xs rounded-md px-2 py-1 border border-zinc-800 bg-zinc-900/70 shrink-0">RPC: not required</span>
        </div>
      </div>
    </section>

    <!-- Live metrics chips -->
    <section class="mt-6 grid grid-cols-2 sm:grid-cols-4 gap-3" aria-label="Live snapshot">
      <div class="rounded-xl p-4 card">
        <div class="flex items-center gap-2 text-xs uppercase tracking-wide text-zinc-400">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" class="opacity-80"><path d="M7 10a4 4 0 118 0 4 4 0 01-8 0Zm-5 9a7 7 0 0114 0" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>
          Waitlist
        </div>
        <div id="wlCount" class="mt-1 text-2xl font-semibold tabular-nums">
          <span class="inline-block w-20 h-6 rounded skeleton"></span>
        </div>
      </div>
      <div class="rounded-xl p-4 card">
        <div class="flex items-center gap-2 text-xs uppercase tracking-wide text-zinc-400">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" class="opacity-80"><path d="M12 2a10 10 0 100 20 10 10 0 000-20Zm0 0c3 3 3 15 0 20M12 2c-3 3-3 15 0 20M2 12h20" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>
          Countries
        </div>
        <div id="wlCountries" class="mt-1 text-2xl font-semibold tabular-nums">
          <span class="inline-block w-16 h-6 rounded skeleton"></span>
        </div>
      </div>
      <div class="rounded-xl p-4 card">
        <div class="flex items-center gap-2 text-xs uppercase tracking-wide text-zinc-400">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" class="opacity-80"><path d="M4 20V8m0 0l-4-4m4 4l4-4M12 20V4m8 16v-8m0 0l4 4m-4-4l-4 4" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>
          Height
        </div>
        <div id="height" class="mt-1 text-2xl font-semibold tabular-nums">
          <span class="inline-block w-24 h-6 rounded skeleton"></span>
        </div>
      </div>
      <div class="rounded-xl p-4 card">
        <div class="flex items-center gap-2 text-xs uppercase tracking-wide text-zinc-400">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" class="opacity-80"><path d="M6 8a3 3 0 116 0 3 3 0 01-6 0Zm9 8a3 3 0 116 0 3 3 0 01-6 0Z" stroke="currentColor" stroke-width="1.2"/><path d="M9 10l6 6" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>
          Peers
        </div>
        <div id="peers" class="mt-1 text-2xl font-semibold tabular-nums">
          <span class="inline-block w-12 h-6 rounded skeleton"></span>
        </div>
      </div>
    </section>

    <!-- Wallet Preview Card -->
    <section class="mt-8 p-6 rounded-2xl card border border-zinc-800" aria-label="Wallet preview">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Wallet Preview</h2>
        <span class="text-xs rounded-md px-2 py-1 border border-zinc-800 bg-zinc-900/70">Non-custodial</span>
      </div>

      <div class="mt-4 grid sm:grid-cols-3 gap-4">
        <div class="sm:col-span-2 rounded-xl p-4 border border-zinc-800">
          <div class="text-sm text-zinc-400">Active account</div>
          <div class="mt-2 text-sm truncate" id="acct">
            <span class="inline-block h-5 w-64 rounded skeleton" aria-hidden="true"></span>
          </div>

          <div class="mt-4 grid grid-cols-2 gap-3">
            <div class="rounded-lg p-3 border border-zinc-800 bg-zinc-900/40">
              <div class="text-xs uppercase tracking-wide text-zinc-400">QTR</div>
              <div class="mt-1 text-2xl font-semibold tabular-nums">
                <span class="inline-block h-6 w-28 rounded skeleton"></span>
              </div>
            </div>
            <div class="rounded-lg p-3 border border-zinc-800 bg-zinc-900/40">
              <div class="text-xs uppercase tracking-wide text-zinc-400">USD (est.)</div>
              <div class="mt-1 text-2xl font-semibold tabular-nums">
                <span class="inline-block h-6 w-24 rounded skeleton"></span>
              </div>
            </div>
          </div>

          <div class="mt-4">
            <div class="text-xs uppercase tracking-wide text-zinc-400">Recent activity</div>
            <ul class="mt-2 space-y-2">
              <li class="rounded-lg p-3 border border-zinc-800 bg-zinc-900/40">
                <span class="inline-block h-4 w-3/4 rounded skeleton"></span>
              </li>
              <li class="rounded-lg p-3 border border-zinc-800 bg-zinc-900/40">
                <span class="inline-block h-4 w-2/3 rounded skeleton"></span>
              </li>
              <li class="rounded-lg p-3 border border-zinc-800 bg-zinc-900/40">
                <span class="inline-block h-4 w-1/2 rounded skeleton"></span>
              </li>
            </ul>
          </div>
        </div>

        <div class="rounded-xl p-4 border border-zinc-800 bg-zinc-900/40">
          <div class="text-sm text-zinc-400">Actions</div>
          <div class="mt-3 grid gap-2">
            <button class="rounded-lg bg-zinc-800/70 px-3 py-2 text-sm cursor-not-allowed opacity-70" disabled>Send</button>
            <button class="rounded-lg bg-zinc-800/70 px-3 py-2 text-sm cursor-not-allowed opacity-70" disabled>Receive</button>
            <button class="rounded-lg bg-zinc-800/70 px-3 py-2 text-sm cursor-not-allowed opacity-70" disabled>Stake</button>
            <a href="/faucet/" class="rounded-lg border border-zinc-700 px-3 py-2 text-sm hover:bg-zinc-800 transition">Faucet</a>
          </div>
          <p class="mt-3 text-xs text-zinc-500">These will activate at go-live.</p>
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section class="mt-8 p-6 rounded-xl card border border-zinc-800">
      <p class="text-lg">We’re putting the final touches on the Quantara Wallet.</p>
      <p class="mt-2 text-zinc-300">Join the <a class="underline hover:no-underline" href="/">Devnet-0 waitlist</a> to get early access. Testnet tokens have no monetary value.</p>
      <div class="mt-4 flex flex-wrap items-center gap-3">
        <a href="/#waitlist" class="rounded-lg border border-zinc-700 px-4 py-2 text-sm hover:bg-zinc-800 transition">Join Waitlist</a>
        <a href="/wallet/" class="rounded-lg bg-yellow-500 px-4 py-2 text-sm font-medium text-black hover:bg-yellow-400 transition">Open Wallet (when live)</a>
        <a href="/explorer/" class="rounded-lg border border-zinc-700 px-4 py-2 text-sm hover:bg-zinc-800 transition">Explorer</a>
      </div>
    </section>

    <footer class="mt-10 text-xs text-zinc-500">
      © 2025 Quantara Technology LLC — Devnet-0 • SS58=73 • Avg block ≈ 6s
    </footer>
  </main>

  <script>
    (function () {
      // --- Wallet release fallback (12 days from now, aligned with your earlier plan) ---
      const FALLBACK_WALLET_RELEASE_AT_ISO = '2025-10-22T17:00:00Z';

      const $ = (id) => document.getElementById(id);

      const fmtDT = (d) => new Intl.DateTimeFormat(undefined,{dateStyle:'medium',timeStyle:'short'}).format(d);
      const setNum = (el, v) => { el?.classList?.remove('skeleton'); el.textContent = (typeof v === 'number') ? v.toLocaleString() : '—'; };

      async function getJSON(path, ms=5000){
        const ctrl = new AbortController(); const to=setTimeout(()=>ctrl.abort(), ms);
        try{
          const r=await fetch(path,{signal:ctrl.signal,credentials:'same-origin',headers:{'Accept':'application/json'}});
          if(!r.ok) return null;
          const ct=r.headers.get('content-type')||''; if(!ct.includes('application/json')) return null;
          return await r.json();
        } catch { return null; } finally { clearTimeout(to); }
      }

      function tickCountdown(iso){
        const badge = $('badge');
        const t = new Date(iso).getTime();
        if (!Number.isFinite(t)) { $('countdown').textContent = '—'; return; }
        const now = Date.now();
        if (now >= t) {
          $('countdown').textContent = 'Live';
          badge.textContent = 'Live';
          badge.classList.add('live');
          return;
        }
        const s = Math.max(0, Math.floor((t-now)/1000));
        const d = Math.floor(s/86400), h = Math.floor((s%86400)/3600), m = Math.floor((s%3600)/60);
        $('countdown').textContent = `${d}d ${h}h ${m}m`;
      }

      function applyRelease(iso){
        const dt = new Date(iso);
        $('releaseAt').dateTime = dt.toISOString();
        $('releaseAt').textContent = fmtDT(dt);
        tickCountdown(iso);
        setInterval(()=>tickCountdown(iso), 30_000);
      }

      async function hydrateConfig(){
        const wrap = await getJSON('/api/config');
        const cfg = wrap?.data || wrap || null;

        if (cfg) {
          if (cfg.ss58Prefix != null) $('ss58').textContent = String(cfg.ss58Prefix);
          if (cfg.tokenDecimals != null) $('decimals').textContent = String(cfg.tokenDecimals);

          if (cfg.rpcWS && /^wss?:\/\//.test(cfg.rpcWS)) {
            $('rpc').textContent = cfg.rpcWS;
            $('rpcChip').textContent = 'RPC: configured';
            $('rpcChip').className = 'text-xs rounded-md px-2 py-1 border border-emerald-700 bg-emerald-900/40';
          } else {
            $('rpc').textContent = 'RPC: not configured';
            $('rpcChip').textContent = 'RPC: not required';
            $('rpcChip').className = 'text-xs rounded-md px-2 py-1 border border-zinc-800 bg-zinc-900/70';
          }

          const apiWalletRelease =
            cfg.walletReleaseAt || cfg.wallet_release_at || cfg.releaseAt || null;

          if (apiWalletRelease) {
            applyRelease(apiWalletRelease);
            return;
          }
        }
        // No API or no wallet release field: use fallback
        applyRelease(FALLBACK_WALLET_RELEASE_AT_ISO);
      }

      async function hydrateMetrics(){
        const wrap = await getJSON('/api/metrics');
        const m = wrap?.data || wrap || null;
        setNum($('wlCount'), m?.waitlistCount);
        setNum($('wlCountries'), m?.countryCount);
        setNum($('height'), m?.height);
        setNum($('peers'), m?.peers);
      }

      // Prefill mock account (purely cosmetic until live)
      (function mockAccount(){
        const seed = (Math.random().toString(36).slice(2, 10)).toUpperCase();
        const fake = `5F${seed}…${seed.slice(0,4)} (${new Date().getUTCFullYear()})`;
        const el = $('acct');
        if (el) el.textContent = fake;
      })();

      hydrateConfig();
      hydrateMetrics();
      setInterval(hydrateMetrics, 10_000); // refresh every 10s
    })();
  </script>
</body>
</html>
