<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Quantara Wallet — Preview</title>
  <meta name="description" content="Preview of the Quantara Wallet for Devnet-0. Join the waitlist for early access."/>
  <meta name="color-scheme" content="dark">
  <link rel="icon" href="data:,">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .skeleton{position:relative;overflow:hidden;background:rgba(255,255,255,.06)}
    .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);
      animation:shimmer 1.2s linear infinite}
    @keyframes shimmer{100%{transform:translateX(100%)}}
    @media (prefers-reduced-motion: reduce){.skeleton::after{animation:none}}
  </style>
</head>
<body class="min-h-screen bg-black text-white selection:bg-yellow-500/30">
  <main class="max-w-4xl mx-auto px-6 py-16">
    <a href="/" class="text-sm opacity-70 hover:opacity-100 transition">&larr; Back to Waitlist</a>

    <header class="mt-6">
      <div class="flex items-center gap-3">
        <h1 class="text-4xl font-semibold tracking-tight">Quantara Wallet</h1>
        <span id="badge" class="text-xs rounded-md px-2 py-1 border border-zinc-800 bg-zinc-900/70">Preview</span>
      </div>
      <p class="mt-2 text-zinc-300">Non-custodial sr25519 • AES-GCM + Argon2id • SS58=<span id="ss58" class="tabular-nums">73</span> • <span id="decimals" class="tabular-nums">12</span> decimals</p>
    </header>

    <!-- Info / countdown -->
    <section class="mt-6 grid md:grid-cols-2 gap-4">
      <div class="rounded-xl border border-zinc-800 bg-zinc-900/60 p-5">
        <div class="text-xs uppercase tracking-wide text-zinc-400">Release</div>
        <time id="releaseAt" class="mt-1 block text-lg font-medium">TBD</time>
        <p id="countdown" class="mt-1 text-sm text-zinc-400">—</p>
      </div>
      <div class="rounded-xl border border-zinc-800 bg-zinc-900/60 p-5">
        <div class="text-xs uppercase tracking-wide text-zinc-400">RPC (WS)</div>
        <div id="rpc" class="mt-1 truncate text-lg font-medium">wss://rpc.devnet-0.quantara.xyz</div>
        <p class="mt-1 text-xs text-zinc-500">Configured from <code>/api/config</code></p>
      </div>
    </section>

    <!-- Live metrics chips -->
    <section class="mt-6 grid grid-cols-2 sm:grid-cols-4 gap-3">
      <div class="rounded-xl border border-zinc-800 bg-zinc-900/60 p-4">
        <div class="text-xs uppercase tracking-wide text-zinc-400">Waitlist</div>
        <div id="wlCount" class="mt-1 text-2xl font-semibold tabular-nums"><span class="inline-block w-20 h-6 rounded skeleton"></span></div>
      </div>
      <div class="rounded-xl border border-zinc-800 bg-zinc-900/60 p-4">
        <div class="text-xs uppercase tracking-wide text-zinc-400">Countries</div>
        <div id="wlCountries" class="mt-1 text-2xl font-semibold tabular-nums"><span class="inline-block w-16 h-6 rounded skeleton"></span></div>
      </div>
      <div class="rounded-xl border border-zinc-800 bg-zinc-900/60 p-4">
        <div class="text-xs uppercase tracking-wide text-zinc-400">Height</div>
        <div id="height" class="mt-1 text-2xl font-semibold tabular-nums"><span class="inline-block w-24 h-6 rounded skeleton"></span></div>
      </div>
      <div class="rounded-xl border border-zinc-800 bg-zinc-900/60 p-4">
        <div class="text-xs uppercase tracking-wide text-zinc-400">Peers</div>
        <div id="peers" class="mt-1 text-2xl font-semibold tabular-nums"><span class="inline-block w-12 h-6 rounded skeleton"></span></div>
      </div>
    </section>

    <!-- Actions -->
    <section class="mt-8 flex flex-wrap items-center gap-3">
      <a href="/#waitlist" class="rounded-lg border border-zinc-700 px-4 py-2 text-sm hover:bg-zinc-800 transition">Join Waitlist</a>
      <a href="/wallet/" class="rounded-lg bg-yellow-500 px-4 py-2 text-sm font-medium text-black hover:bg-yellow-400 transition">Open Wallet (when live)</a>
      <a href="/faucet/" class="rounded-lg border border-zinc-700 px-4 py-2 text-sm hover:bg-zinc-800 transition">Faucet</a>
      <a href="/explorer/" class="rounded-lg border border-zinc-700 px-4 py-2 text-sm hover:bg-zinc-800 transition">Explorer</a>
    </section>

    <section class="mt-8 p-6 rounded-xl bg-zinc-900 border border-zinc-800">
      <p class="text-lg">We’re putting the final touches on the Quantara Wallet.</p>
      <p class="mt-2 text-zinc-300">Join the <a class="underline hover:no-underline" href="/">Devnet-0 waitlist</a> to get early access. Testnet tokens have no monetary value.</p>
    </section>

    <footer class="mt-10 text-xs text-zinc-500">
      © 2025 Quantara Technology LLC — Devnet-0 • SS58=73 • Avg block ≈ 6s
    </footer>
  </main>

  <script>
    (function () {
      // --- Wallet release fallback (12 days from now) ---
      // Prefer API fields if present; else use this ISO.
      const FALLBACK_WALLET_RELEASE_AT_ISO = '2025-10-22T17:00:00Z';

      const $ = (id) => document.getElementById(id);

      function fmtDT(d){ return new Intl.DateTimeFormat(undefined,{dateStyle:'medium',timeStyle:'short'}).format(d); }

      // tiny fetch helper with timeout
      async function getJSON(path, ms=5000){
        const ctrl = new AbortController(); const to=setTimeout(()=>ctrl.abort(), ms);
        try{ const r=await fetch(path,{signal:ctrl.signal,credentials:'same-origin'}); if(!r.ok) return null; return await r.json(); }
        catch{ return null; } finally{ clearTimeout(to); }
      }

      function setNum(el, v){ el.classList.remove('skeleton'); el.textContent = typeof v==='number' ? v.toLocaleString() : '—'; }

      function tickCountdown(dt){
        const now = Date.now(), t = new Date(dt).getTime();
        const badge = $('badge');
        if (!t || Number.isNaN(t)) { $('countdown').textContent = '—'; return; }
        if (now >= t) { $('countdown').textContent = 'Live'; badge.textContent = 'Live'; return; }
        const s = Math.max(0, Math.floor((t-now)/1000));
        const d = Math.floor(s/86400), h = Math.floor((s%86400)/3600), m = Math.floor((s%3600)/60);
        $('countdown').textContent = `${d}d ${h}h ${m}m`;
      }

      function applyRelease(iso){
        const dt = new Date(iso);
        $('releaseAt').dateTime = dt.toISOString();
        $('releaseAt').textContent = fmtDT(dt);
        tickCountdown(iso);
        setInterval(()=>tickCountdown(iso), 30_000);
      }

      async function hydrateConfig(){
        const wrap = await getJSON('/api/config');
        const cfg = wrap?.data || wrap || null;

        if (cfg) {
          if (cfg.ss58Prefix != null) $('ss58').textContent = String(cfg.ss58Prefix);
          if (cfg.tokenDecimals != null) $('decimals').textContent = String(cfg.tokenDecimals);
          if (cfg.rpcWS) $('rpc').textContent = cfg.rpcWS;

          const apiWalletRelease =
            cfg.walletReleaseAt || cfg.wallet_release_at || cfg.releaseAt || null;

          if (apiWalletRelease) {
            applyRelease(apiWalletRelease);
            return;
          }
        }
        // No API or no wallet release field: use fallback
        applyRelease(FALLBACK_WALLET_RELEASE_AT_ISO);
      }

      async function hydrateMetrics(){
        const wrap = await getJSON('/api/metrics');
        const m = wrap?.data || wrap || null;
        if (!m) {
          setNum($('wlCount'), null); setNum($('wlCountries'), null);
          setNum($('height'), null);  setNum($('peers'), null);
          return;
        }
        setNum($('wlCount'), m.waitlistCount);
        setNum($('wlCountries'), m.countryCount);
        setNum($('height'), m.height);
        setNum($('peers'), m.peers);
      }

      hydrateConfig();
      hydrateMetrics();
      setInterval(hydrateMetrics, 10000); // refresh every 10s
    })();
  </script>
</body>
</html>
