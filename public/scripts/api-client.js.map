{
  "version": 3,
  "sources": ["api-client.ts"],
  "sourcesContent": ["// public/scripts/api-client.ts\r\nimport type {\r\n  ApiResponse,\r\n  GetResponse,\r\n  PostResponse,\r\n  EndpointMap,\r\n  PostEndpointMap,\r\n  FetchJsonOptions,\r\n  JSONObject,\r\n} from \"../../types/api.js\";\r\n\r\n// ---- helpers to extract success branch\r\ntype Ok<T> = T extends { ok: true } ? T : never;\r\ntype OkData<T> = T extends { ok: true; data: infer D } ? D : never;\r\n\r\nconst DEFAULT_TIMEOUT_MS = 10_000;\r\n\r\nfunction makeTimeoutSignal(\r\n  upstream: AbortSignal | null | undefined,\r\n  ms: number = DEFAULT_TIMEOUT_MS\r\n): { signal: AbortSignal | undefined; clear: () => void } {\r\n  if (!ms) return { signal: upstream ?? undefined, clear: () => {} };\r\n  const ctl = new AbortController();\r\n  const t = setTimeout(() => ctl.abort(), ms);\r\n  if (upstream) {\r\n    if (upstream.aborted) ctl.abort();\r\n    else upstream.addEventListener(\"abort\", () => ctl.abort(), { once: true });\r\n  }\r\n  return { signal: ctl.signal, clear: () => clearTimeout(t) };\r\n}\r\n\r\n// ---- loosen doFetch generic; we\u2019ll narrow after parsing\r\ntype FetchInit = Omit<RequestInit, \"signal\"> & {\r\n  timeoutMs?: number;\r\n  signal?: AbortSignal | null | undefined;\r\n  // treat these statuses as \"API missing\" and don't spam the console\r\n  quietStatuses?: number[]; // default: [404, 405]\r\n};\r\n\r\nasync function doFetch<TRaw = unknown>(\r\n  path: string,\r\n  init: FetchInit = {}\r\n): Promise<TRaw> {\r\n  const {\r\n    timeoutMs,\r\n    signal: upstreamSignal,\r\n    quietStatuses = [404, 405],\r\n    ...rest\r\n  } = init;\r\n\r\n  const { signal, clear } = makeTimeoutSignal(\r\n    upstreamSignal ?? undefined,\r\n    timeoutMs ?? DEFAULT_TIMEOUT_MS\r\n  );\r\n\r\n  const headers = new Headers(rest.headers || {});\r\n  if (rest.body && typeof rest.body === \"string\" && !headers.has(\"Content-Type\")) {\r\n    headers.set(\"Content-Type\", \"application/json\");\r\n  }\r\n  if (!headers.has(\"Accept\")) headers.set(\"Accept\", \"application/json\");\r\n\r\n  const reqInit: RequestInit = {\r\n    credentials: \"same-origin\",\r\n    ...rest,\r\n    headers,\r\n    // DOM types allow AbortSignal | null\r\n    signal: signal ?? null,\r\n  };\r\n\r\n  let res: Response;\r\n  try {\r\n    res = await fetch(path, reqInit);\r\n  } finally {\r\n    clear();\r\n  }\r\n\r\n  // Flag \u201CAPI not present in this environment\u201D and throw a soft error\r\n  if (quietStatuses.includes(res.status)) {\r\n    (window as any).__Q_NO_API__ = true;\r\n    throw {\r\n      ok: false,\r\n      status: res.status,\r\n      code: res.status === 404 ? \"NOT_FOUND\" : \"METHOD_NOT_ALLOWED\",\r\n      message: `API route missing: ${path}`,\r\n    };\r\n  }\r\n\r\n  const ct = res.headers.get(\"content-type\") || \"\";\r\n  let parsed: unknown = null;\r\n\r\n  if (ct.includes(\"application/json\")) {\r\n    try {\r\n      parsed = await res.json();\r\n    } catch {\r\n      /* fall through to text */\r\n    }\r\n  }\r\n  if (parsed == null) {\r\n    const text = await res.text();\r\n    parsed = text ? { ok: res.ok, status: res.status, message: text } : { ok: res.ok };\r\n  }\r\n\r\n  // If it has an ok:false, throw a normalized error\r\n  const maybe = parsed as Partial<ApiResponse<any>> & { status?: number; message?: string };\r\n  if (!res.ok || maybe.ok === false) {\r\n    const err =\r\n      maybe.ok === false\r\n        ? maybe\r\n        : {\r\n            ok: false,\r\n            status: res.status,\r\n            code: res.statusText || \"HTTP_ERROR\",\r\n            message:\r\n              maybe.message ||\r\n              `Request failed (${res.status}${res.statusText ? \" \" + res.statusText : \"\"})`,\r\n          };\r\n    throw err;\r\n  }\r\n\r\n  return parsed as TRaw;\r\n}\r\n\r\n// ---- Public typed wrappers\r\n\r\nexport async function get<Path extends keyof EndpointMap>(\r\n  path: Path,\r\n  opts: Omit<FetchJsonOptions, \"method\" | \"body\"> & {\r\n    timeoutMs?: number;\r\n    fallback?: OkData<GetResponse<Path>>;\r\n  } = {}\r\n): Promise<OkData<GetResponse<Path>>> {\r\n  const { fallback, ...rest } = opts as any;\r\n  try {\r\n    const raw = await doFetch<GetResponse<Path>>(path as string, { method: \"GET\", ...rest });\r\n    const ok = raw as Ok<GetResponse<Path>>;\r\n    return ok.data as OkData<GetResponse<Path>>;\r\n  } catch (e) {\r\n    if (fallback !== undefined) return fallback;\r\n    throw e;\r\n  }\r\n}\r\n\r\nexport async function post<Path extends keyof PostEndpointMap, Body extends JSONObject>(\r\n  path: Path,\r\n  body: Body,\r\n  opts: Omit<FetchJsonOptions<Body>, \"method\" | \"body\"> & {\r\n    timeoutMs?: number;\r\n    fallback?: OkData<PostResponse<Path>>;\r\n  } = {}\r\n): Promise<OkData<PostResponse<Path>>> {\r\n  const { fallback, ...rest } = opts as any;\r\n  try {\r\n    const raw = await doFetch<PostResponse<Path>>(path as string, {\r\n      method: \"POST\",\r\n      body: JSON.stringify(body),\r\n      ...rest,\r\n    });\r\n    const ok = raw as Ok<PostResponse<Path>>;\r\n    return ok.data as OkData<PostResponse<Path>>;\r\n  } catch (e) {\r\n    if (fallback !== undefined) return fallback;\r\n    throw e;\r\n  }\r\n}\r\n\r\n// ------------------------ Optional DOM helpers (frontend-safe) --------------\r\n\r\nfunction hydrateDomFromConfig(cfg: { rpcWS?: string; releaseAt: string }) {\r\n  const rpcEl = document.getElementById(\"rpc-url\");\r\n  // Only write RPC if we actually have one\r\n  if (rpcEl && cfg.rpcWS) rpcEl.textContent = cfg.rpcWS;\r\n\r\n  const badge = document.getElementById(\"live-badge\");\r\n  if (badge) badge.textContent = \"Preview\";\r\n\r\n  const fmt = new Intl.DateTimeFormat(undefined, { dateStyle: \"medium\", timeStyle: \"short\" });\r\n  [\"preview-release-time\", \"preview-release-time-2\"].forEach((id) => {\r\n    const t = document.getElementById(id) as HTMLTimeElement | null;\r\n    if (t) {\r\n      t.dateTime = cfg.releaseAt;\r\n      t.textContent = fmt.format(new Date(cfg.releaseAt));\r\n    }\r\n  });\r\n}\r\n\r\nexport async function hydrateConfig() {\r\n  // Local, API-free config (no RPC)\r\n  const localCfg = {\r\n    chainName: \"Devnet-0\",\r\n    tokenSymbol: \"QTR\",\r\n    tokenDecimals: 12,\r\n    ss58Prefix: 73,\r\n    rpcWS: \"\", // no RPC in this environment\r\n    releaseAt: new Date().toISOString(),\r\n    explorer: {\r\n      homepage: \"/explorer/\",\r\n      account: \"/explorer/account/{address}\",\r\n      tx: \"/explorer/tx/{hash}\",\r\n    },\r\n    links: {\r\n      wallet: \"/wallet/\",\r\n      faucet: \"/faucet/\",\r\n      status: \"/status/\",\r\n      explorer: \"/explorer/\",\r\n    },\r\n  } as const;\r\n\r\n  // If API was already determined missing, don't fetch again.\r\n  if (typeof window !== \"undefined\" && (window as any).__Q_NO_API__) {\r\n    hydrateDomFromConfig(localCfg);\r\n    return localCfg as any;\r\n  }\r\n\r\n  try {\r\n    const cfg = await get(\"/api/config\", { fallback: localCfg as any, timeoutMs: 4000 });\r\n    hydrateDomFromConfig(cfg as any);\r\n    return cfg;\r\n  } catch {\r\n    (window as any).__Q_NO_API__ = true;\r\n    hydrateDomFromConfig(localCfg);\r\n    return localCfg as any;\r\n  }\r\n}\r\n\r\nexport async function hydrateMetrics() {\r\n  // If API is missing, just use local fallback and update DOM quietly\r\n  const fallback = {\r\n    waitlistCount: 0,\r\n    countryCount: 0,\r\n    avgBlockSeconds: 6,\r\n    ss58Prefix: 73,\r\n    updatedAt: new Date().toISOString(),\r\n  } as any;\r\n\r\n  let m: any = fallback;\r\n  if (!(typeof window !== \"undefined\" && (window as any).__Q_NO_API__)) {\r\n    try {\r\n      m = await get(\"/api/metrics\", { fallback });\r\n    } catch {\r\n      (window as any).__Q_NO_API__ = true;\r\n      m = fallback;\r\n    }\r\n  }\r\n\r\n  const height = document.getElementById(\"height\");\r\n  if (height && typeof m.height === \"number\") height.textContent = m.height.toLocaleString();\r\n\r\n  const peers = document.getElementById(\"peers\");\r\n  if (peers && typeof m.peers === \"number\") peers.textContent = String(m.peers);\r\n\r\n  const map: Record<string, number | undefined> = {\r\n    waitlist: m.waitlistCount,\r\n    countries: m.countryCount,\r\n  };\r\n\r\n  document.querySelectorAll<HTMLElement>(\"[data-countup-key]\").forEach((el) => {\r\n    const key = el.getAttribute(\"data-countup-key\")!;\r\n    const end = map[key];\r\n    if (typeof end !== \"number\") {\r\n      el.closest(\"[data-hide-if-empty]\")?.classList.add(\"hidden\");\r\n      return;\r\n    }\r\n    animateCountup(el, end);\r\n  });\r\n\r\n  return m;\r\n}\r\n\r\nfunction animateCountup(el: HTMLElement, end: number, dur = 900) {\r\n  const start = performance.now();\r\n  const startVal = 0;\r\n  const step = (t: number) => {\r\n    const k = Math.min(1, (t - start) / dur);\r\n    const cur = Math.floor(startVal + (end - startVal) * k);\r\n    el.textContent = cur.toLocaleString();\r\n    if (k < 1) requestAnimationFrame(step);\r\n  };\r\n  requestAnimationFrame(step);\r\n}\r\n\r\ndeclare global {\r\n  interface Window {\r\n    Api?: {\r\n      get: typeof get;\r\n      post: typeof post;\r\n      hydrateConfig: typeof hydrateConfig;\r\n      hydrateMetrics: typeof hydrateMetrics;\r\n      __Q_NO_API__?: boolean;\r\n    };\r\n  }\r\n}\r\n\r\nif (typeof window !== \"undefined\") {\r\n  window.Api = { get, post, hydrateConfig, hydrateMetrics };\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
